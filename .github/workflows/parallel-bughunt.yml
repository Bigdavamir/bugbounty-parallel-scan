name: Parallel BugHunt

on:
  workflow_dispatch:
    inputs:
      domain:
        description: "Target domain (e.g., example.com)"
        required: true

jobs:
  bughunt:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies (jq, moreutils)
        run: |
          sudo apt update
          sudo apt install -y jq moreutils

      - name: Install Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.22'

      - name: Install bugbounty tools
        run: |
          set -e

          # waybackurls
          go install github.com/tomnomnom/waybackurls@latest
          cp ~/go/bin/waybackurls /usr/local/bin/

          # anew
          go install github.com/tomnomnom/anew@latest
          cp ~/go/bin/anew /usr/local/bin/

          # unfurl
          go install github.com/tomnomnom/unfurl@latest
          cp ~/go/bin/unfurl /usr/local/bin/

          # gau (binary release)
          echo "==> Resolving gau download URLâ€¦"
          GAU_URL=$(curl -s https://api.github.com/repos/lc/gau/releases/latest \
            | grep "browser_download_url.*linux_amd64" \
            | grep -o 'https://[^"]*' \
            | head -n1)
          echo "Downloading gau from: $GAU_URL"
          wget -q -O gau "$GAU_URL"
          chmod +x gau
          sudo mv gau /usr/local/bin/gau

          # httpx
          go install github.com/projectdiscovery/httpx/cmd/httpx@latest
          cp ~/go/bin/httpx /usr/local/bin/

          # kxss
          go install github.com/tomnomnom/kxss@latest
          cp ~/go/bin/kxss /usr/local/bin/

          # x8
          go install github.com/Sh1Yo/x8/cmd/x8@latest
          cp ~/go/bin/x8 /usr/local/bin/

          # Fix PATH in environment (useful for custom steps)
          echo "/usr/local/bin" >> $GITHUB_PATH

      - name: Make main.sh executable
        run: chmod +x main.sh

      - name: Run main.sh
        run: ./main.sh ${{ github.event.inputs.domain }}

      - name: Archive recon results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: recon-results
          path: ./*_recon/
